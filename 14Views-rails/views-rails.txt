
# Criando a primeira view

Como você já viu anteriormente o Rails utiliza o padrão MVC por convenção e por isso o próximo passo neste momento é criar o controller e as views para o Post.

## Passo a Passo

1- Utilize um generator para criar o controller Posts
    * rails g controller Posts

2- Defina uma action chamada **index** dentro do controller criado no passo anterior

   * def index
     @posts = Post.all
     end

3- É preciso mapear a rota para a action **index** dentro do arquivo `config/routes.rb`

    * get '/posts', to: 'posts#index'

4- Com toda essa estrutura criada, agora o passo final é criar a view que será renderizada pelo seu controller. 

    - Dentro da pasta `app/views/posts`, crie um arquivo chamado `index.html.erb`

5- Adicione o seguinte conteúdo dentro desse arquivo

<h1>Posts</h1>

<% if @posts %>
  <% @posts.each do |post| %>
    <%= post.title %>
  <% end %>
<% else %>
  <p>Nenhum post cadastrado</p>
<% end %>



6- Perceba que é possível executar código rails dentro de uma view através da utilização de tags especiais. 

Veja a seguir o significado dessas tags:

-   <%= Código %>
   — Insere o resultado da expressão em sua página html.

-   <% Código %>
  
   — Executa a instrução, porém, não retorna nenhum valor para a sua página html.

-   <%# COMMENT %>
  
   — Comenta a declaração da tag.

7- As validações allow_nil adicionadas no model Post durante as missões do último módulo só fazem sentido quando utilizadas em conjunto com outras validações. Por isso remova elas para seguir esta aula.

8- Crie um novo post através do **rails console** e depois atualize a página index de posts para visualizar a mudança.


================================================================================================================================================


# Layout da aplicação


## Conhecendo um layout

1- Veja o layout padrão gerado pelo Ruby on Rails abrindo o arquivo app/views/layouts/application.html.erb

2- O código `<%= yield %> ` define onde deve ser renderizado o conteúdo de uma action dentro do layout.

Por isso você não precisa definir as tags html, head e body dentro da view de alguma action. O layout padrão da aplicação já adiciona essa estrutura para você.


## Criando um layout

Por causa da real possibilidade  da necessidade de mais de um layout dentro da mesma aplicação o rails permite que você utilize quantos layouts quiser. Um exemplo básico disso é um site que possui um layout para usuários não autenticados e um layout para os autenticados. 

Você deve criar todos os seus layouts dentro da past `app/views/layouts`

1- Crie um novo layout chamado `post.html.erb`

2- Adicione o seguinte conteúdo dentro dele
 

<!DOCTYPE html>
<html>
  <head>
    <title>Blog - Posts </title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_pack_tag 'application', 'data-turbolinks-track': 'reload' %>
  </head>

  <body>
    <h1>Dominando o Ruby on Rails</h1>
    </br>
    <%= yield %>
  </body>
</html>


3- Para utilizar o layout criado nos passos anteriores utilize o método `layout` após a definição da classe Posts em `app/controllers/posts_controller.rb`
  * layout 'post'

  Obs: Agora todas as views de Posts compartilharão a mesma estrutura presente dentro desse layout.

4- Levante o servidor, abra a página index de Posts e veja como ela está sendo renderizada

5- Também é possível fazer a definição de layout para uma action em específico através da renderização da resposta.

  * def index
      @posts = Post.all
      render layout: "application"
    end


6- Atualize a página index de Posts novamente para ver o resultado da configuração anterior.


================================================================================================================================================


# Removendo a complexidade das views com Helpers

  - O Ruby on Rails conta com algo chamado Helpers para remover das páginas html as lógicas complexas do seu código e por fim tornar seu projeto mais organizado.
  - Além disso, um helper também pode ser reutilizado em mais de uma página, evitando a repetição de código.
  - Por padrão, o rails já inicia um projeto com alguns helpers predefinidos, mas também existe a possibilidade de você criar seus próprios helpers.


## Helpers predefinidos

1- Abra o projeto **blog**, navegue até a página **index** de **Posts** e substitua seu conteúdo pelo código a seguir para  apresentar os dados por meio de uma tabela

      <h1>Posts</h1>

      <% if @posts %>
        <table>
          <thead>
            <tr>
              <th>Title</th>
              <th>Created</th>
            </tr>
          </thead>
          <tbody>
            <% @posts.each do |post| %>
              <tr>
                <td><%= post.title %></td>
                <td><%= post.created_at</td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <p> No results found </p>
      <% end %>



2- Utilize o helper **time_ago_in_words** para formatar a data em que o post foi criado

          <td><%= time_ago_in_words(post.created_at) %> ago</td>



4- Também é possível utilizar os helpers dentro do **Rails Console** com a variável **helper**

helper.number_to_human(100000)



## Escrevendo seus próprios helpers

Perceba que na aplicação **blog** existe uma pasta localizada dentro de **app** chamada **helpers**. Ela é destinada para a escrita dos seus próprios helpers. 

Cada arquivo presente dentro desta pasta símboliza onde os helpers poderão ser acessados, sendo que, quando o nome do arquivo é **application_helper.rb** trata-se de algo padrão que foi iniciado junto à sua aplicação equanto arquivos com o nome de um controller são criados por um genenator de um Controller. 

Essas duas divisões ajudam a saber onde criar um helper, pois todos os heleprs definidos dentro do arquivo **application_helper.rb**  estarão disponíveis para todas as views da sua aplicação, enquanto os helpers com o nome do controller estarão disponíveis apenas na view desse controller. 



Um Helper nada mais é do que um método.
1- Crie seu primeiro helper dentro de `app/helpers/authors_helper.rb`

      module AuthorsHelper
        def number_of_posts(author)
          if author.posts.count > 0
            author.posts.count
          else
            'None'
          end
        end
      end



2- Agora, utilize o helper criado anteriormente dentro da sua view `app/views/authors/index.html.erb`

      <th>Description</th>
      <th>Posts</th>
      <th colspan="3"></th>
      [...]
        <td><%= author.description %></td>
        <td><%= number_of_posts(author) %></td>
        <td><%= link_to 'Show', author %></td>




3- Suba sua aplicação e veja como ficou o projeto depois da inserção do helper que conta a quantidade de posts  de um autor.


  docs:   https://mixandgo.com/learn/the-beginners-guide-to-rails-helpers

          https://www.rubyguides.com/2020/01/rails-helpers/

          https://api.rubyonrails.org/v6.1.3.1/classes/ActionView/Helpers.html


================================================================================================================================================